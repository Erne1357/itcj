{% extends "core/mobile/base_mobile.html" %}

{% block title %}ITCJ - Mi Perfil{% endblock %}

{% block extra_css %}
<link rel="stylesheet"
    href="{{ url_for('static', filename='core/css/mobile/profile.css') }}?v={{ sv('core', 'css/mobile/profile.css') }}">
{% endblock %}

{% block content %}
<div class="mobile-profile-container">
    <!-- Avatar grande -->
    <div class="mobile-profile-avatar-section">
        <div class="mobile-profile-avatar-lg">
            {{ user.first_name[:1]|upper }}{{ user.last_name[:1]|upper }}
        </div>
        <h2 class="mobile-profile-name">{{ user.full_name }}</h2>
        <span class="mobile-profile-role-badge">
            <i class="bi bi-mortarboard"></i> Estudiante
        </span>
    </div>

    <!-- Informacion personal -->
    <div class="mobile-profile-section">
        <h3 class="mobile-profile-section-title">
            <i class="bi bi-person"></i> Informacion Personal
        </h3>

        <div class="mobile-profile-field">
            <div class="mobile-profile-field-label">Nombre completo</div>
            <div class="mobile-profile-field-value">{{ user.full_name }}</div>
        </div>

        <div class="mobile-profile-field">
            <div class="mobile-profile-field-label">Numero de control</div>
            <div class="mobile-profile-field-value">
                <i class="bi bi-hash"></i> {{ user.control_number }}
            </div>
        </div>

        {% if user.email %}
        <div class="mobile-profile-field">
            <div class="mobile-profile-field-label">Correo electronico</div>
            <div class="mobile-profile-field-value">
                <i class="bi bi-envelope"></i> {{ user.email }}
            </div>
        </div>
        {% endif %}

        <div class="mobile-profile-field">
            <div class="mobile-profile-field-label">Estado</div>
            <div class="mobile-profile-field-value">
                {% if user.is_active %}
                <span class="badge bg-success"><i class="bi bi-check-circle"></i> Activo</span>
                {% else %}
                <span class="badge bg-danger"><i class="bi bi-x-circle"></i> Inactivo</span>
                {% endif %}
            </div>
        </div>

        {% if user.created_at %}
        <div class="mobile-profile-field">
            <div class="mobile-profile-field-label">Miembro desde</div>
            <div class="mobile-profile-field-value">
                <i class="bi bi-calendar3"></i>
                {{ user.created_at.strftime('%d/%m/%Y') }}
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Cerrar sesion -->
    <div class="mobile-profile-section">
        <button class="mobile-profile-logout-btn" id="logoutBtn">
            <i class="bi bi-box-arrow-right"></i>
            Cerrar Sesion
        </button>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    // Logout
    document.getElementById('logoutBtn').addEventListener('click', async () => {
        try {
            await fetch('/api/core/v1/auth/logout', {
                method: 'POST',
                credentials: 'include'
            });
            window.location.href = '/itcj/login';
        } catch (e) {
            window.location.href = '/itcj/login';
        }
    });
});
</script>
{% endblock %}
