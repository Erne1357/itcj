{% extends "core/mobile/base_mobile.html" %}

{% block title %}ITCJ - Mi Perfil{% endblock %}

{% block extra_css %}
<style>
    .mobile-profile-iframe-container {
        position: fixed;
        top: calc(var(--mobile-header-height) + var(--mobile-safe-top, 0px));
        left: 0;
        right: 0;
        bottom: calc(var(--mobile-bottom-nav-height) + var(--mobile-safe-bottom, 0px));
        z-index: 1;
    }

    .mobile-profile-iframe-container iframe {
        width: 100%;
        height: 100%;
        border: none;
    }

    /* Ocultar main padding cuando usamos iframe */
    .mobile-main {
        padding: 0 !important;
        min-height: 0 !important;
    }

    /* Boton flotante de logout */
    .mobile-profile-fab-logout {
        position: fixed;
        bottom: calc(var(--mobile-bottom-nav-height) + var(--mobile-safe-bottom, 0px) + 16px);
        right: 16px;
        z-index: 10;
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: #ef4444;
        color: white;
        border: none;
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        cursor: pointer;
        transition: transform 0.15s, box-shadow 0.15s;
    }

    .mobile-profile-fab-logout:active {
        transform: scale(0.92);
    }

    .mobile-profile-fab-logout:hover {
        box-shadow: 0 6px 16px rgba(239, 68, 68, 0.5);
    }
</style>
{% endblock %}

{% block content %}
<div class="mobile-profile-iframe-container">
    <iframe src="{{ url_for('pages_core.pages_profile.profile') }}"
        title="Mi Perfil" loading="eager"></iframe>
</div>

<!-- Boton flotante de logout -->
<button class="mobile-profile-fab-logout" id="logoutBtn" title="Cerrar sesion">
    <i class="bi bi-box-arrow-right"></i>
</button>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('logoutBtn').addEventListener('click', async () => {
        if (!confirm('Â¿Cerrar sesion?')) return;
        try {
            await fetch('/api/core/v1/auth/logout', {
                method: 'POST',
                credentials: 'include'
            });
            window.location.href = '/itcj/login';
        } catch (e) {
            window.location.href = '/itcj/login';
        }
    });
});
</script>
{% endblock %}
