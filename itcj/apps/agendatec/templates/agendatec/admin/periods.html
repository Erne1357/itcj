{% extends "agendatec/base.html" %}
{% block title %}Admin · Períodos Académicos{% endblock %}

{% block content %}
<div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
  <h1 class="h5 h4-md mb-0">Períodos<span class="d-none d-sm-inline"> Académicos</span></h1>
  <div class="d-flex flex-wrap gap-2">
    <select id="fltStatus" class="form-select form-select-sm" style="width: auto; min-width: 110px;">
      <option value="">Todos<span class="d-none d-sm-inline"> los estados</span></option>
      <option value="ACTIVE">Activo</option>
      <option value="INACTIVE">Inactivo</option>
      <option value="ARCHIVED">Archivado</option>
    </select>
    <button id="btnReload" class="btn btn-outline-primary btn-sm"><i class="bi bi-arrow-repeat"></i></button>
    <button id="btnNew" class="btn btn-primary btn-sm"><i class="bi bi-plus-lg"></i><span class="d-none d-sm-inline"> Nuevo Período</span></button>
  </div>
</div>

<div class="card shadow-sm">
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>Código</th>
          <th>Nombre</th>
          <th>Inicio</th>
          <th>Fin</th>
          <th>Ventana Admisión</th>
          <th>Estado</th>
          <th>Solicitudes</th>
          <th style="width: 200px;">Acciones</th>
        </tr>
      </thead>
      <tbody id="tblPeriodsBody">
        <!-- filas vía JS -->
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block modals %}
<!-- Modal Nuevo/Editar Período -->
<div class="modal fade" id="mdlPeriod" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 id="mdlTitle" class="modal-title">Nuevo Período</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label">Código <span class="text-danger">*</span></label>
            <input id="fCode" class="form-control" placeholder="Ej: 20261" maxlength="6" required>
            <div class="form-text">Ej: 20253 (Ago-Dic), 20261 (Ene-Jun), 20262 (Verano)</div>
          </div>

          <div class="col-md-8">
            <label class="form-label">Nombre del Período <span class="text-danger">*</span></label>
            <input id="fName" class="form-control" placeholder="Ej: Ago-Dic 2025" required>
            <div class="form-text">Ejemplo: "Ago-Dic 2025", "Ene-Jun 2026", "Verano 2026"</div>
          </div>

          <div class="col-md-6">
            <label class="form-label">Fecha de Inicio <span class="text-danger">*</span></label>
            <input id="fStartDate" type="date" class="form-control" required>
          </div>

          <div class="col-md-6">
            <label class="form-label">Fecha de Fin <span class="text-danger">*</span></label>
            <input id="fEndDate" type="date" class="form-control" required>
          </div>

          <div class="col-12">
            <hr class="my-2">
            <h6 class="text-muted">Ventana de Admisión de Solicitudes</h6>
          </div>

          <div class="col-md-6">
            <label class="form-label">Fecha Inicio Admisión <span class="text-danger">*</span></label>
            <input id="fAdmissionStartDate" type="date" class="form-control" required>
          </div>

          <div class="col-md-6">
            <label class="form-label">Hora Inicio Admisión <span class="text-danger">*</span></label>
            <input id="fAdmissionStartTime" type="time" class="form-control" value="00:00" required>
            <div class="form-text">Hora zona: America/Ciudad_Juarez</div>
          </div>

          <div class="col-md-6">
            <label class="form-label">Fecha Límite de Admisión <span class="text-danger">*</span></label>
            <input id="fDeadlineDate" type="date" class="form-control" required>
          </div>

          <div class="col-md-6">
            <label class="form-label">Hora Límite de Admisión <span class="text-danger">*</span></label>
            <input id="fDeadlineTime" type="time" class="form-control" value="18:00" required>
            <div class="form-text">Hora zona: America/Ciudad_Juarez</div>
          </div>

          <div class="col-12">
            <label class="form-label">Estado</label>
            <select id="fStatus" class="form-select">
              <option value="INACTIVE">Inactivo</option>
              <option value="ACTIVE">Activo</option>
              <option value="ARCHIVED">Archivado</option>
            </select>
            <div class="form-text">Solo puede haber un período ACTIVO a la vez</div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button id="btnSavePeriod" class="btn btn-primary">Guardar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Ver Detalles -->
<div class="modal fade" id="mdlDetails" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Detalles del Período</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div id="detailsContent">
          <!-- contenido dinámico -->
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Confirmación -->
<div class="modal fade" id="mdlConfirm" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title" id="mdlConfirmTitle">Confirmar acción</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="d-flex align-items-start gap-3">
          <div class="fs-1"><i class="bi bi-question-circle-fill text-warning"></i></div>
          <div id="mdlConfirmBody" class="flex-grow-1"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-warning" id="btnConfirmAction">Confirmar</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  // Endpoints a usar desde JS:
  window.__adminPeriodsCfg = {
    listUrl: "{{ url_for('agendatec_api.api_periods.list_periods') }}",
    createUrl: "{{ url_for('agendatec_api.api_periods.create_period') }}",
    detail: "{{ url_for('agendatec_api.api_periods.get_period', period_id=999999) }}".replace('999999', '{id}'),
    update: "{{ url_for('agendatec_api.api_periods.update_period', period_id=999999) }}".replace('999999', '{id}'),
    delete: "{{ url_for('agendatec_api.api_periods.delete_period', period_id=999999) }}".replace('999999', '{id}'),
    activate: "{{ url_for('agendatec_api.api_periods.activate_period', period_id=999999) }}".replace('999999', '{id}'),
    stats: "{{ url_for('agendatec_api.api_periods.get_period_stats', period_id=999999) }}".replace('999999', '{id}'),
    daysPage: "{{ url_for('agendatec_pages.admin_pages.admin_period_days', period_id=999999) }}".replace('999999', '{id}')
  };
</script>
<script src="{{ url_for('static', filename='agendatec/js/admin/periods.js') }}?v={{ sv('agendatec', 'js/admin/periods.js') }}"></script>
{% endblock %}
